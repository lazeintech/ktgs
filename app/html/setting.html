<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <title>Cài đặt admin - Phần mềm kiểm tra giám sát</title>
  <link rel="stylesheet" href="style.css">
</head>

<body id="icnk" onload="onLoad()">
  <div id="i5qg">
    <div id="i967">
      <div id="ieh4" class="container-width">
        <div class="logo-container">
        </div>
        <div class="clearfix">
        </div>
      </div>
      <div data-tabs="1" id="i1r88">
        <div data-gjs="navbar" class="navbar">
          <div id="i2em1r" class="navbar-container">
            <a href="/" class="navbar-brand"></a>
            <div id="bar-burger" class="navbar-burger">
              <div class="navbar-burger-line">
              </div>
              <div class="navbar-burger-line">
              </div>
              <div class="navbar-burger-line">
              </div>
            </div>
            <div data-gjs="navbar-items" class="navbar-items-c">
              <nav data-gjs="navbar-menu" class="navbar-menu">
                <a>Xin chào, <b id="user">
                  </b></a>
                <script type="text/javascript">
                  document.getElementById("user").innerHTML = sessionStorage.getItem("username");
                </script>
                <a href="/logout" class="navbar-menu-link">Đăng xuất</a>
                <a href="#" id="menu" class="navbar-menu-link">Menu chính</a>
              </nav>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div data-tabs="1" id="is6rr">
    <nav data-tab-container="1" class="tab-container">
      <a href="#tab1" data-tab="1" class="tab" id="tabid1">Tạo tài khoản</a>
      <a href="#tab2" data-tab="1" class="tab" id="tabid2">Thêm lớp</a>
      <a href="#tab3" data-tab="1" class="tab" id="tabid3">Phân công lớp</a>
      <a href="#tab4" data-tab="1" class="tab" id="tabid4">Tuỳ chỉnh Danh mục vi phạm</a>
      <a href="#tab5" data-tab="1" class="tab" id="tabid5">Tuỳ chỉnh Đơn vị</a>
      <a href="#tab6" data-tab="1" class="tab" id="tabid6">Thống kê</a>
    </nav>
    <div id="tab1" data-tab-content="1" class="tab-content">
      <form action="/api/add_user" class="form" id="ine15" method="post">
        <div class="form-group">
          <div>
            <table id="tbl-acc-list" style="width:50%" align="center">
              <tr>
                <th>Tài khoản đã tạo</th>
                <th>Mật khẩu </th>
              </tr>
            </table>
          </div>
          <label class="label" id="i85xj" required>Tên đăng nhập:</label>
          <input placeholder="Nhập tên đăng nhập" class="input" name="username" />
          <label class="label" id="il004" required>Mật khẩu:</label>
          <input placeholder="Nhập mật khẩu" class="input" name="password" />
          <button type="submit" class="button" id="addUser">Tạo tài khoản</button>
        </div>
      </form>
    </div>
    <div id="tab2" data-tab-content="1" class="tab-content">
      <form class="form" id="itc77" action="/api/import_classes" enctype="multipart/form-data" method="post">
        <div class="form-group">
          <label class="label" id="ivio6">Chọn file danh sách lớp để thêm:</label>
          <input type="file" id="studentList" name="studentList" value="Chọn DS" required />
          <button type="submit" class="button">Thêm lớp</button>
        </div>
      </form>
    </div>
    <div id="tab3" data-tab-content="1" class="tab-content">
      <form class="form" id="iepnx" action="/api/assign_job" method="post">
        <div class=" form-group">
          <label class="label">Lớp:</label>
          <select class="select" id="drop-classes" name="classCode" required>
          </select>
          <label class="label" id="i3hhi">Cán bộ:</label>
          <select class="select" id="drop-job-accounts" name="username" required>
          </select>
          <label class="label">Nhiệm vụ:</label>
          <select class="select" id="drop-job-type" name="jobType" required>
            <option value="">- Chọn nhiệm vụ -</option>
            <option value="thi">I - KIỂM TRA GIÁM SÁT THI</option>
            <option value="thvd">II - KIỂM TRA GIÁM SÁT THI THỰC HÀNH VẤN ĐÁP</option>
          </select>
          <label class="label" id="">Thời gian từ ngày:</label>
          <input type="date" id="assignFrom" name="assignFrom" required />
          <label class="label" id="">Đến ngày:</label>
          <input type="date" id="assignTo" name="assignTo" required />
          <button type="submit" class="button" id="assign">Phân công</button>
        </div>
      </form>
    </div>
    <div id="tab4" data-tab-content="1" class="tab-content">
      <form class="form" action="/api/add_violation_detail" method="post">
        <div class="form-group">
          <label class="label" id="iorzgu">Chọn danh mục vi phạm</label>
          <select class="select" id="drop-violation" name="job" required>
            <option value="">- Chọn danh mục -</option>
            <option value="1">I.1 TỔ CHỨC THI</option>
            <option value="2">I.2 LÀM ĐỀ</option>
            <option value="3">I.3 COI THI</option>
            <option value="4">I.4 LÀM PHÁCH GỬI BÀI</option>
            <option value="5">I.5 CHẤM THI</option>
            <option value="6">I.6 THẨM ĐỊNH LUẬN VĂN LUẬN ÁN</option>
            <option value="7">II GIÁM SÁT THI THỰC HÀNH VẤN ĐÁP</option>
          </select>
          Danh mục vi phạm đã có:
          <div class="row" id="existing-violation">
          </div>
          <label class="label" id="ialv75">Thêm Danh mục vi phạm:</label>
          <input placeholder="Danh mục vi phạm" class="input" id="detail" name="detail" required />
          <button type="submit" class="button">Thêm</button>
        </div>
      </form>
    </div>
    <div id="tab5" data-tab-content="1" class="tab-content">
      <form class="form" action="/api/add_department" method="post">
        <div class="form-group">
          Đơn vị đã có:
          <div class="row" id="existing-department">
          </div>
          <label class="label" id="ialv75">Thêm Đơn vị:</label>
          <input placeholder="Tên đơn vị" class="input" id="department" name="department" required />
          <button type="submit" class="button">Thêm</button>
        </div>
      </form>
    </div>
    <div id="tab6" data-tab-content="1" class="tab-content">
      <form class="form" action="/api/statistic" method="post">
        <div class="form-group">
          <label class="label" id="">Thời gian từ:</label>
          <input type="date" id="fromDate" name="fromDate" required />
          <label class="label" id="">Đến:</label>
          <input type="date" id="toDate" name="toDate" required />
          <label class="label" id="ihy0nj">Lớp</label>
          <select class="select" id="drop-report-classes">
          </select>
          <label class="label" id="">Cán bộ phụ trách</label>
          <select class="select" id="drop-report-accounts">
          </select>
          <label class="label" id="">Danh mục vi phạm</label>
          <select class="select" id="drop-report-violations">
          </select>
          <button type="submit" class="button">Thống kê</button>
        </div>
      </form>
    </div>
  </div>
</body>
<script>
  var items = document.querySelectorAll('#i1r88');
  for (var i = 0, len = items.length; i < len; i++) {
    (function () {
      var t, e = this, a = "[data-tab]", n = document.body, r = n.matchesSelector || n.webkitMatchesSelector || n.mozMatchesSelector || n.msMatchesSelector, o = function () {
        var a = e.querySelectorAll("[data-tab-content]") || [];
        for (t = 0; t < a.length; t++)a[t].style.display = "none"
      }
        , i = function (n) {
          var r = e.querySelectorAll(a) || [];
          for (t = 0; t < r.length; t++) {
            var i = r[t], s = i.className.replace("tab-active", "").trim();
            i.className = s
          }
          o(), n.className += " tab-active";
          var l = n.getAttribute("href"), c = e.querySelector(l);
          c && (c.style.display = "")
        }
        , s = e.querySelector(".tab-active" + a);
      s = s || e.querySelector(a), s && i(s), e.addEventListener("click", function (t) {
        var e = t.target;
        r.call(e, a) && i(e)
      }
      )
    }
      .bind(items[i]))();
  }
  var items = document.querySelectorAll('#is6rr');
  for (var i = 0, len = items.length; i < len; i++) {
    (function () {
      var t, e = this, a = "[data-tab]", n = document.body, r = n.matchesSelector || n.webkitMatchesSelector || n.mozMatchesSelector || n.msMatchesSelector, o = function () {
        var a = e.querySelectorAll("[data-tab-content]") || [];
        for (t = 0; t < a.length; t++)a[t].style.display = "none"
      }
        , i = function (n) {
          var r = e.querySelectorAll(a) || [];
          for (t = 0; t < r.length; t++) {
            var i = r[t], s = i.className.replace("tab-active", "").trim();
            i.className = s
          }
          o(), n.className += " tab-active";
          var l = n.getAttribute("href"), c = e.querySelector(l);
          c && (c.style.display = "")
        }
        , s = e.querySelector(".tab-active" + a);
      s = s || e.querySelector(a), s && i(s), e.addEventListener("click", function (t) {
        var e = t.target;
        r.call(e, a) && i(e)
      }
      )
    }
      .bind(items[i]))();
  }
  var items = document.querySelectorAll('#bar-burger');
  for (var i = 0, len = items.length; i < len; i++) {
    (function () {
      var e, t = 0,
        n = function () {
          var e, t = document.createElement("void"),
            n = {
              transition: "transitionend",
              OTransition: "oTransitionEnd",
              MozTransition: "transitionend",
              WebkitTransition: "webkitTransitionEnd"
            };
          for (e in n)
            if (void 0 !== t.style[e]) return n[e]
        }(),
        r = function (e) {
          var t = window.getComputedStyle(e),
            n = t.display,
            r = (t.position, t.visibility, t.height, parseInt(t["max-height"]));
          if ("none" !== n && "0" !== r) return e.offsetHeight;
          e.style.height = "auto", e.style.display = "block", e.style.position = "absolute", e.style.visibility = "hidden";
          var i = e.offsetHeight;
          return e.style.height = "", e.style.display = "", e.style.position = "", e.style.visibility = "", i
        },
        i = function (e) {
          t = 1;
          var n = r(e),
            i = e.style;
          i.display = "block", i.transition = "max-height 0.25s ease-in-out", i.overflowY = "hidden", "" == i["max-height"] && (i["max-height"] = 0), 0 == parseInt(i["max-height"]) ? (i["max-height"] = "0", setTimeout(function () {
            i["max-height"] = n + "px"
          }, 10)) : i["max-height"] = "0"
        },
        a = function (r) {
          if (r.preventDefault(), !t) {
            var a = this.closest("[data-gjs=navbar]"),
              o = a.querySelector("[data-gjs=navbar-items]");
            i(o), e || (o.addEventListener(n, function () {
              t = 0;
              var e = o.style;
              0 == parseInt(e["max-height"]) && (e.display = "", e["max-height"] = "")
            }), e = 1)
          }
        };
      "gjs-collapse" in this || this.addEventListener("click", a), this["gjs-collapse"] = 1
    }.bind(items[i]))();
  }

  document.getElementById("menu").addEventListener("click",
    function () {
      location.replace(location.origin + "/menu");
    },
    false
  );

  function onLoad() {
    // get data from server and fill
    // classes 
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var formDrop = document.getElementById("drop-classes");
        var reportDrop = document.getElementById("drop-report-classes");
        formDrop.innerHTML = reportDrop.innerHTML = "<option value=\"\">- Chọn lớp -</option>";
        var classes = JSON.parse(this.responseText);
        classes.forEach(cls => {
          var option = document.createElement("option");
          option.value = cls.classCode;
          option.text = cls.classCode;
          formDrop.appendChild(option);

          var option1 = document.createElement("option");
          option1.value = cls.classCode;
          option1.text = cls.classCode;
          reportDrop.appendChild(option1);
        });
      }
    };
    xmlhttp.open("POST", location.origin + "/api/get_classes", true);
    xmlhttp.send();

    // user account
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var accounts = JSON.parse(this.responseText);
        var accList = document.getElementById("tbl-acc-list");
        accounts.forEach(account => {
          var row = accList.insertRow(accList.rows.length);
          cell1 = row.insertCell(0);
          cell1.innerHTML = account.username;
          cell2 = row.insertCell(1);
          cell2.innerHTML = account.password;
        });

        var reportDrop = document.getElementById("drop-report-accounts");
        var assignDrop = document.getElementById("drop-job-accounts");
        assignDrop.innerHTML = reportDrop.innerHTML = "<option value=\"\">- Chọn cán bộ -</option>";
        accounts.forEach(account => {
          var option = document.createElement("option");
          option.value = account.username;
          option.text = account.username;
          assignDrop.appendChild(option);

          var option1 = document.createElement("option");
          option1.value = account.username;
          option1.text = account.username;
          reportDrop.appendChild(option1);
        });
      }
    };
    xmlhttp.open("POST", location.origin + "/api/get_accounts", true);
    xmlhttp.send();

    // department
    document.getElementById("existing-department").innerHTML = "";
    var xmlhttp = new XMLHttpRequest();
    xmlhttp.onreadystatechange = function () {
      if (this.readyState == 4 && this.status == 200) {
        var depts = JSON.parse(this.responseText);
        var cnt = 1;
        depts.forEach(dept => {
          document.getElementById("existing-department").innerHTML
            += cnt++ + ". " + dept.name + "<br/>";
        });
      };
    };
    xmlhttp.open("POST", location.origin + "/api/get_department", true);
    xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xmlhttp.send();

    // goto tab
    var url_string = location.href;
    var url = new URL(url_string);
    var tab = url.searchParams.get("tab");
    console.log(tab);
    if (tab)
      document.getElementById(tab).click();
  }

  document.getElementById("drop-violation").addEventListener("change",
    function () {
      document.getElementById("existing-violation").innerText = "";
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function () {
        if (this.readyState == 4 && this.status == 200) {
          var violations = JSON.parse(this.responseText);
          var cnt = 1;
          violations.forEach(violation => {
            document.getElementById("existing-violation").innerText
              += cnt++ + ". " + violation.detail + "\n";
          });
        };
      };
      xmlhttp.open("POST", location.origin + "/api/get_violation_detail", true);
      xmlhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
      xmlhttp.send(JSON.stringify({ "job": this.value }));
    });

  function validate_violation() {
    if (document.getElementById("drop-violation").value == "" ||
      document.getElementById("detail").value == "") {
      alert("Hãy chọn tất cả các ô dữ liệu");
      return false;
    }

    return confirm("Xác nhận Danh mục vi phạm?");
  }
</script>